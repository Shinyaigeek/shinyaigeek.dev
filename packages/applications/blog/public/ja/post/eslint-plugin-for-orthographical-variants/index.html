<!DOCTYPE html><html lang="ja"><head><title>コードの表記揺れを縛るESLintプラグイン | shinyaigeek.dev</title><meta charset="utf8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><meta property="og:title" content="コードの表記揺れを縛るESLintプラグイン | shinyaigeek.dev"><meta property="og:site_name" content="shinyaigeek.dev"><meta property="og:locale" content="ja_JP"><meta name="description" content="Web が好きなオタクのブログ. 主にweb開発の知見について喋ります"><meta property="og:description" content="Web が好きなオタクのブログ. 主にweb開発の知見について喋ります"><meta property="og:url" content="https://shinyaigeek.dev/ja/post/eslint-plugin-for-orthographical-variants"><meta name="twitter:site" content="@shinyaigeek"><meta property="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta property="og:image" content="https://ja.shinyaigeek.dev/assets/ogimage/ja/eslint-plugin-for-orthographical-variants.png"><meta name="twitter:image" content="https://ja.shinyaigeek.dev/assets/ogimage/ja/eslint-plugin-for-orthographical-variants.png"><link rel="icon" type="image/x-icon" href="/assets/static/favicon.ico"><link rel="stylesheet" type="text/css" href="/assets/styles.ada9902fc362b01889c3.css"><link rel="stylesheet" type="text/css" href="/assets/static/a11y-dark.min.css"><link rel="stylesheet" href="https://unpkg.com/github-calendar@latest/dist/github-calendar-responsive.css"><link rel="preload" as="style" href="/assets/static/a11y-dark.min.css"><link rel="preload" as="style" href="/assets/styles.ada9902fc362b01889c3.css"><link rel="preload" as="style" href="https://unpkg.com/github-calendar@latest/dist/github-calendar-responsive.css"><link rel="preload" as="image" href="/assets/static/icon_transparent_header.png"><link rel="alternate" type="application/rss+xml" title="shinyaigeek.dev" href="/rss.xml"></head><body><div id="_app"><div class="fmapAu0fpx364Dzl_9z0"><div class="J2e3WZniL57BvLtita5T"><div class="kVHiWHyN1gv5Y41SpACy"><a href="/" class="link2Home"><div><img src="/assets/static/icon_transparent_header.png" alt="icon" class="vwQ8HQPKPoICc2atrDju" width="36px" height="36px">shinyaigeek.dev</div></a></div><div class="hOkVSJvM823tjX0FjgO_"><div class="FpNMxf5Gx0pwkDBdeqif"><details><summary> <span role="img" aria-label="language"><g-emoji fallback-src="/assets/static/earth_africa.png" alias="earth">🌍</g-emoji></span> 日本語</summary><div class="ZAVxrSvsXSeI9pV9Rbax"><a href="http://ja.shinyaigeek.dev/post/eslint-plugin-for-orthographical-variants" class="aYFqAG93sRJ7BJMCPjsa undefined"><span role="img" aria-label="country"><g-emoji fallback-src="/assets/static/jp.png" alias="Japan">🇯🇵</g-emoji></span>日本語</a><a href="https://en.shinyaigeek.dev/post/eslint-plugin-for-orthographical-variants" class="aYFqAG93sRJ7BJMCPjsa"><span role="img" aria-label="country"><span><g-emoji fallback-src="/assets/static/us.png" alias="America">🇺🇸</g-emoji><g-emoji fallback-src="/assets/static/gb.png" alias="United States">🇬🇧</g-emoji></span></span>English</a></div></details></div><div class="FpNMxf5Gx0pwkDBdeqif"><a href="/" class="link2Home">Blog</a></div><div class="FpNMxf5Gx0pwkDBdeqif"><a href="/profile" id="link2profile">Profile</a></div><div class="FpNMxf5Gx0pwkDBdeqif"><a href="https://github-activity.shinyaigeek.dev/" id="link2activity">Activity</a></div></div></div><div class="sxaQUUuymSmhNwqAMaks"><div><details class="h0AHqg9AmVXjXCnYqFqc"><summary class="post--anchor__title" id="post--anchor__title">目次</summary><a href="#2__0">これは何</a><a href="#2__1">plugin の概要</a><a href="#2__2">モチベーション</a><a href="#2__3">仕組み</a><a href="#2__4">なぜいらないの？</a></details><div class="Y8c8TlU3k_Y72ndSGmnk"><h1>コードの表記揺れを縛るESLintプラグイン</h1><div>2022/03/15</div><div class="BYkaTwWlH4C2pP1hi2JY"><div>Programming</div><div>JavaScript</div><div>DX</div><div>Frontend</div></div></div><div class="L6tHhpo3uw534DnsakEH"><h2 id="2__0">これは何</h2>
<p>コードの表記揺れを縛るESLint Pluginを作った. 大体作り終えてテスト描いてる途中にいやコスト対効果が薄いなこれとなってしまい, 面白くもなければ技術的にすごくもない, かと言って便利というわけでもないいい感じに湿気る怪物を産んでしまったのでその供養.</p>
<h2 id="2__1">plugin の概要</h2>
<p>上述の通りコードの表記揺れを縛るESLint Pluginです.</p>
<p><a href="https://github.com/Shinyaigeek/eslint-plugin-ban-orthographical-variant">https://github.com/Shinyaigeek/eslint-plugin-ban-orthographical-variant</a></p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Audio"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"synonyms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"Speech"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Music"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Video"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"synonyms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"Movie"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"TV Show"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Game"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Animation"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Documentary"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Image"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"synonyms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"Photo"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Drawing"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Painting"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Photograph"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Illustration"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>こういう感じの辞書ファイルを用意しておくと,</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> audioPath = <span class="hljs-string">"hoge"</span>; <span class="hljs-comment">// ok</span>
<span class="hljs-keyword">const</span> musicPath = <span class="hljs-string">"hoge"</span>; <span class="hljs-comment">// warning!</span>
</code></pre>
<p>こういうJavaScript/TypeScriptにおけるコード中の表記ゆれを縛ってくれるESLint Pluginです. 縛る対象としては宣言可能なId的なやつほぼ全部で,</p>
<ul>
<li>変数名</li>
<li>関数名</li>
<li>class 名</li>
<li>メソッド名</li>
<li>enum 名</li>
<li>interface 名</li>
<li>etc...</li>
</ul>
<p>などなど, 多分大体網羅できてる気がします.</p>
<h2 id="2__2">モチベーション</h2>
<p>コードの表記揺れ, 複数の手で作られるようなコードベースだとそこまで珍しいものでもないですが, 我々エンジニアという生き物は何事にも意味を見出そうとしてしまうため, 単なる表記揺れの意味を考えてしまったり, 地味に検索abilityも落ちるので辛いです. また事業ドメインの単語が, コードベース中だと別の言葉になってしまっている, と言ったこともたま〜によくあり, そうなると新しくプロジェクトに参画した人にとっては意味のわからない謎になってしまいます.</p>
<p>そもそも事業ドメインの単語が多いと辛いよね, という話もあり, 辞書ファイルをみんなで管理している, と言った例も見かけます. これは辞書ファイルを管理するついでにこの表記揺れもしばれると嬉しいのでは, と思い作りました.</p>
<h2 id="2__3">仕組み</h2>
<p>わざわざ書くほどのものでもないですが,</p>
<ol>
<li>eslint の持つ AST 中の特定の Node にアクセスする</li>
<li>変数名を取得する</li>
<li>表記揺れチェック</li>
</ol>
<p>という感じです.</p>
<pre><code class="hljs language-typescript">    <span class="hljs-title class_">VariableDeclarator</span>(node) {
        <span class="hljs-keyword">const</span> identifier = node.<span class="hljs-property">id</span>;

        <span class="hljs-keyword">const</span> variableNames = <span class="hljs-title function_">getVariableNameFromBindingName</span>(identifier);

        <span class="hljs-keyword">const</span> dictionaryPath = <span class="hljs-title function_">getDictionaryPath</span>(options[<span class="hljs-number">0</span>].<span class="hljs-property">dictionaryPath</span>);
        <span class="hljs-keyword">const</span> dictionary = <span class="hljs-title function_">getDictionary</span>(dictionaryPath);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> variableName <span class="hljs-keyword">of</span> variableNames) {
          <span class="hljs-title function_">lintWithVariable</span>(
            variableName,
            dictionary,
            <span class="hljs-function">(<span class="hljs-params">originWord, synomsysWord</span>) =></span>
              <span class="hljs-title function_">report</span>({
                node,
                <span class="hljs-attr">messageId</span>: <span class="hljs-string">"banOrthographicalVariant"</span>,
                <span class="hljs-attr">data</span>: {
                  originWord,
                  synomsysWord,
                },
              })
          );
        }
      },
</code></pre>
<p>上記のコードは一例ですが, VariableDeclarator (=変数宣言) の node にアクセスしています.</p>
<p>VariableDeclarator のにおける <code>node.id</code> は</p>
<ul>
<li><code>Identifier</code></li>
</ul>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> hoge = <span class="hljs-string">"hoge"</span>;
</code></pre>
<ul>
<li><code>ArrayPattern</code></li>
</ul>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> [hoge] = [<span class="hljs-string">"hoge"</span>];
</code></pre>
<ul>
<li><code>ObjectPattern</code></li>
</ul>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> { hoge } = { <span class="hljs-attr">hoge</span>: <span class="hljs-string">"hoge"</span> };
</code></pre>
<p>の3通り取り得ます. それぞれの場合においていい感じに変数名に当たるものを全て取得します. (<code>ObjectPattern</code> や <code>ArrayPattern</code> はネスとされていることもあるので再帰的に取得する必要があります)</p>
<p>あとは辞書ファイルをロードして表記揺れかどうか判定するだけです.</p>
<p>どんな感じに動いているかは, 僕の描きかけのテストを見てください. <a href="https://github.com/Shinyaigeek/eslint-plugin-ban-orthographical-variant/blob/main/src/__tests__/ban-orthographical-variant.test.ts">https://github.com/Shinyaigeek/eslint-plugin-ban-orthographical-variant/blob/main/src/__tests__/ban-orthographical-variant.test.ts</a></p>
<h2 id="2__4">なぜいらないの？</h2>
<p>テストのためにmock用の辞書ファイル書いてたらそもそも辞書ファイル書きたくないことに気づいてしまった, やるならここをハックすべきだった気がする.</p></div><div class="XTxSDCE1gmhoF59UaA7g"><div class="mdGYkZO2YHxhxRXU338z"><div class="O6UishUpXe8xGlTrCl8G"><img src="/assets/static/icon_transparent.png" class="J5UgGRYhWe9JWeYlm2bw" alt="monkey-icon" width="270px" height="270px"></div><div class="cab8_7jeBIe5dRHd8ikS"><div class="kEage_DVZV_Stt0z3eAT"><div class="_5U8hWpqU834VUiKxwCpA"><img src="/assets/static/earth.png" alt="earth" width="50px" height="50px"></div></div></div></div><div class="baseprofile"><div class="_pakeuUKwDGIGV1PIDFI">Hi <span role="img" aria-label="wave hand">👋</span> I&#x27;m <span class="zQUgJkaqGKzVRFrvk7mk">Shinobu Hayashi a.k.a Shinyaigeek(しにゃい)</span>.</div><div class="CMC6WyjhCeKfvY5zyyq0"><span data-text="Web Developer" class="v7yavk2O9dr3NZXn186P">Web Developer</span> <g-emoji fallback-src="/assets/static/spider_web.png" alias="spider-web">🕸</g-emoji> / <span data-text="Reliable web Enthusiast" class="v7yavk2O9dr3NZXn186P">Reliable Web Enthusiast</span> <g-emoji fallback-src="/assets/static/fire.png" alias="fire">🔥</g-emoji> </div><div class="gA7tXpIz5V3YPffc9WIr">Faster, Lighter, More accessible, More secure, More productive Web for anyone, anytime , anywhere.</div><div class="v0ZqRqZjlqevKrsWtDTt"><div class="zdvavtYkqc1dXYPR1y0c"><a id="twitter" href="https://twitter.com/Shinyaigeek"><img src="/assets/static/twitter.svg" alt="twitter" width="54px" height="54px"></a></div><div class="zdvavtYkqc1dXYPR1y0c"><a id="github" href="https://github.com/Shinyaigeek"><img src="/assets/static/github.svg" alt="github" width="54px" height="54px"></a></div><div class="zdvavtYkqc1dXYPR1y0c"><a id="linkedin" href="https://www.linkedin.com/in/shinyaigeek/"><img src="/assets/static/linkedin.svg" alt="linkedin" width="54px" height="54px"></a></div></div><div class="l5KzSvykijElHJc7q2c9"><a href="mailto:me@shinyaigeek.dev">Contact Me on Email <g-emoji fallback-src="/assets/static/email.png" alias="email">📧</g-emoji></a></div></div></div></div></div><div class="AJQSVdi_FHylcHDbYLWV">Copyright. 2022 Shinyaigeek</div></div></div></body><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;0893ac88cf0542af88bfd9b93008b408&quot;, &quot;spa&quot;: true}"></script><script defer="" src="/assets/r.a0d01c88f547277aab5a.js" async=""></script></html>