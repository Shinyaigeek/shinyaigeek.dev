<!DOCTYPE html><html lang="en"><head><title>Treeche, Tree-Shakable Checker for JavaScript/TypeScript Application to reduce bundle size | shinyaigeek.dev</title><meta charset="utf8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><meta property="og:title" content="Treeche, Tree-Shakable Checker for JavaScript/TypeScript Application to reduce bundle size | shinyaigeek.dev"><meta property="og:site_name" content="shinyaigeek.dev"><meta property="og:locale" content="ja_JP"><meta name="description" content="Web „ÅåÂ•Ω„Åç„Å™„Ç™„Çø„ÇØ„ÅÆ„Éñ„É≠„Ç∞. ‰∏ª„Å´webÈñãÁô∫„ÅÆÁü•Ë¶ã„Å´„Å§„ÅÑ„Å¶Âñã„Çä„Åæ„Åô"><meta property="og:description" content="Web „ÅåÂ•Ω„Åç„Å™„Ç™„Çø„ÇØ„ÅÆ„Éñ„É≠„Ç∞. ‰∏ª„Å´webÈñãÁô∫„ÅÆÁü•Ë¶ã„Å´„Å§„ÅÑ„Å¶Âñã„Çä„Åæ„Åô"><meta property="og:url" content="https://shinyaigeek.dev/en/post/introduction-treeche"><meta name="twitter:site" content="@shinyaigeek"><meta property="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta property="og:image" content="https://en.shinyaigeek.dev/assets/ogimage/en/introduction-treeche.png"><meta name="twitter:image" content="https://en.shinyaigeek.dev/assets/ogimage/en/introduction-treeche.png"><link rel="icon" type="image/x-icon" href="/assets/static/favicon.ico"><link rel="stylesheet" type="text/css" href="/assets/styles.ada9902fc362b01889c3.css"><link rel="stylesheet" type="text/css" href="/assets/static/a11y-dark.min.css"><link rel="stylesheet" href="https://unpkg.com/github-calendar@latest/dist/github-calendar-responsive.css"><link rel="preload" as="style" href="/assets/static/a11y-dark.min.css"><link rel="preload" as="style" href="/assets/styles.ada9902fc362b01889c3.css"><link rel="preload" as="style" href="https://unpkg.com/github-calendar@latest/dist/github-calendar-responsive.css"><link rel="preload" as="image" href="/assets/static/icon_transparent_header.png"><link rel="alternate" type="application/rss+xml" title="shinyaigeek.dev" href="/rss.xml"></head><body><div id="_app"><div class="fmapAu0fpx364Dzl_9z0"><div class="J2e3WZniL57BvLtita5T"><div class="kVHiWHyN1gv5Y41SpACy"><a href="/" class="link2Home"><div><img src="/assets/static/icon_transparent_header.png" alt="icon" class="vwQ8HQPKPoICc2atrDju" width="36px" height="36px">shinyaigeek.dev</div></a></div><div class="hOkVSJvM823tjX0FjgO_"><div class="FpNMxf5Gx0pwkDBdeqif"><details><summary> <span role="img" aria-label="language"><g-emoji fallback-src="/assets/static/earth_africa.png" alias="earth">üåç</g-emoji></span> English</summary><div class="ZAVxrSvsXSeI9pV9Rbax"><a href="http://ja.shinyaigeek.dev/post/introduction-treeche" class="aYFqAG93sRJ7BJMCPjsa"><span role="img" aria-label="country"><g-emoji fallback-src="/assets/static/jp.png" alias="Japan">üáØüáµ</g-emoji></span>Êó•Êú¨Ë™û</a><a href="https://en.shinyaigeek.dev/post/introduction-treeche" class="aYFqAG93sRJ7BJMCPjsa undefined"><span role="img" aria-label="country"><span><g-emoji fallback-src="/assets/static/us.png" alias="America">üá∫üá∏</g-emoji><g-emoji fallback-src="/assets/static/gb.png" alias="United States">üá¨üáß</g-emoji></span></span>English</a></div></details></div><div class="FpNMxf5Gx0pwkDBdeqif"><a href="/" class="link2Home">Blog</a></div><div class="FpNMxf5Gx0pwkDBdeqif"><a href="/profile" id="link2profile">Profile</a></div><div class="FpNMxf5Gx0pwkDBdeqif"><a href="https://github-activity.shinyaigeek.dev/" id="link2activity">Activity</a></div></div></div><div class="sxaQUUuymSmhNwqAMaks"><div><details class="h0AHqg9AmVXjXCnYqFqc"><summary class="post--anchor__title" id="post--anchor__title">Table of Contents</summary><a href="#2__0">What is Treeche?</a><a href="#2__1">Example</a><a href="#2__2">What is side-effect in the context of module bundling?</a><a href="#2__3">Why does side-effect cause an increase of bundle-size?</a><a href="#2__4">How to use?</a><a href="#2__5">Options</a><a href="#2__6">How to work?</a><a href="#2__7">Feedback</a></details><div class="Y8c8TlU3k_Y72ndSGmnk"><h1>Treeche, Tree-Shakable Checker for JavaScript/TypeScript Application to reduce bundle size</h1><div>2022/08/27</div><div class="BYkaTwWlH4C2pP1hi2JY"><div>Programming</div><div>JavaScript</div><div>DX</div><div>Frontend</div></div></div><div class="L6tHhpo3uw534DnsakEH"><h2 id="2__0">What is Treeche?</h2>
<p>Treeche stands for <strong>Tree</strong> -Shakable <strong>Che</strong> cker. You can check whether or not your JavaScript/TypeScript Application is tree-shakable with Treeche, and this diagnose will allow you to reduce bundle size and optimize UserExperience!!</p>
<p><a href="https://github.com/Shinyaigeek/treeche">https://github.com/Shinyaigeek/treeche</a></p>
<h2 id="2__1">Example</h2>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// this is not tree-shakable because have side-effect</span>

<span class="hljs-keyword">const</span> currentYear = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getFullYear</span>();

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCurrentYear</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Year <span class="hljs-subst">${currentYear}</span>`</span>
}
</code></pre>
<p>The above code is not tree-shakable, because the above typescript module has side-effect.</p>
<p>Treeche show the diagnose like below for the above code:</p>
<pre><code class="hljs language-shell">üö® ~/application/side_effect.ts is not tree-shakable due to the following code:


const currentYear = new Date().getFullYear();
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</code></pre>
<p>If you fix the module with side-effect to the module which does not have side-effect like below.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCurrentYear</span>(<span class="hljs-params">currentDate: <span class="hljs-built_in">Date</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Year <span class="hljs-subst">${currentDate.getFullYear()}</span>`</span>
}
</code></pre>
<p>and Treeche will show the diagnose like below:</p>
<pre><code class="hljs language-shell">Congratulation üéâ All files are tree-shakeable ‚ú®
</code></pre>
<h2 id="2__2">What is side-effect in the context of module bundling?</h2>
<p>A side-effect in ECMAScript module context is a code that effects outside the module. For example, it is side-effect to set a variable to <code>window</code> object in module top-level like below:</p>
<pre><code class="hljs language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">m</span> = <span class="hljs-number">1</span>;
<span class="hljs-keyword">export</span> <span class="hljs-title function_">mod</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}
</code></pre>
<p>Of course, if this were to happend in <code>init</code> module, this will not be invoked on import so this will no longer be a side effect.</p>
<h2 id="2__3">Why does side-effect cause an increase of bundle-size?</h2>
<p>You can check bundler's behavior with rollup relp:</p>
<p>URL: <a href="https://rollupjs.org/repl/?version=2.78.1&#x26;shareable=JTdCJTIybW9kdWxlcyUyMiUzQSU1QiU3QiUyMm5hbWUlMjIlM0ElMjJtYWluLmpzJTIyJTJDJTIyY29kZSUyMiUzQSUyMmltcG9ydCUyMCU3QiUyMGhvZ2UlMjAlN0QlMjBmcm9tJTIwJTVDJTIyLiUyRm1vZCU1QyUyMiUzQiU1Q24lNUNuY29uc29sZS5sb2coaG9nZSgpKSUyMiUyQyUyMmlzRW50cnklMjIlM0F0cnVlJTdEJTJDJTdCJTIybmFtZSUyMiUzQSUyMm1vZC5qcyUyMiUyQyUyMmNvZGUlMjIlM0ElMjJleHBvcnQlMjBmdW5jdGlvbiUyMGhvZ2UoKSUyMCU3QiU1Q24lNUN0cmV0dXJuJTIwMSUzQiU1Q24lN0QlNUNuJTVDbmV4cG9ydCUyMGZ1bmN0aW9uJTIwZnVnYSgpJTIwJTdCJTVDbiU1Q3RyZXR1cm4lMjBuZXclMjBEYXRlKCkuZ2V0RnVsbFllYXIoKSUzQiU1Q24lN0QlMjIlN0QlNUQlMkMlMjJvcHRpb25zJTIyJTNBJTdCJTIyZm9ybWF0JTIyJTNBJTIyZXMlMjIlMkMlMjJuYW1lJTIyJTNBJTIybXlCdW5kbGUlMjIlMkMlMjJhbWQlMjIlM0ElN0IlMjJpZCUyMiUzQSUyMiUyMiU3RCUyQyUyMmdsb2JhbHMlMjIlM0ElN0IlN0QlN0QlMkMlMjJleGFtcGxlJTIyJTNBbnVsbCU3RA==">https://rollupjs.org/repl/?version=2.78.1&#x26;shareable=JTdCJTIybW9kdWxlcyUyMiUzQSU1QiU3QiUyMm5hbWUlMjIlM0ElMjJtYWluLmpzJTIyJTJDJTIyY29kZSUyMiUzQSUyMmltcG9ydCUyMCU3QiUyMGhvZ2UlMjAlN0QlMjBmcm9tJTIwJTVDJTIyLiUyRm1vZCU1QyUyMiUzQiU1Q24lNUNuY29uc29sZS5sb2coaG9nZSgpKSUyMiUyQyUyMmlzRW50cnklMjIlM0F0cnVlJTdEJTJDJTdCJTIybmFtZSUyMiUzQSUyMm1vZC5qcyUyMiUyQyUyMmNvZGUlMjIlM0ElMjJleHBvcnQlMjBmdW5jdGlvbiUyMGhvZ2UoKSUyMCU3QiU1Q24lNUN0cmV0dXJuJTIwMSUzQiU1Q24lN0QlNUNuJTVDbmV4cG9ydCUyMGZ1bmN0aW9uJTIwZnVnYSgpJTIwJTdCJTVDbiU1Q3RyZXR1cm4lMjBuZXclMjBEYXRlKCkuZ2V0RnVsbFllYXIoKSUzQiU1Q24lN0QlMjIlN0QlNUQlMkMlMjJvcHRpb25zJTIyJTNBJTdCJTIyZm9ybWF0JTIyJTNBJTIyZXMlMjIlMkMlMjJuYW1lJTIyJTNBJTIybXlCdW5kbGUlMjIlMkMlMjJhbWQlMjIlM0ElN0IlMjJpZCUyMiUzQSUyMiUyMiU3RCUyQyUyMmdsb2JhbHMlMjIlM0ElN0IlN0QlN0QlMkMlMjJleGFtcGxlJTIyJTNBbnVsbCU3RA==</a></p>
<p><strong>main.js</strong></p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { hoge } <span class="hljs-keyword">from</span> <span class="hljs-string">"./mod"</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">hoge</span>())
</code></pre>
<p><strong>mod.js</strong></p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">hoge</span>(<span class="hljs-params"></span>) {
	<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fuga</span>(<span class="hljs-params"></span>) {
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getFullYear</span>();
}
</code></pre>
<p>and bundled result by rollup is like above:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hoge</span>(<span class="hljs-params"></span>) {
	<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">hoge</span>());
</code></pre>
<p>You know <code>fuga</code> module in <code>mod.js</code> is tree-shaken because the bundler know <code>fuga</code> module is not imported( and of course not used) and the bundler does not need to include <code>fuga</code> module to its bundle output, and this lead a decrease of bundle-size.</p>
<p>However, if your edit <code>mod.js</code> like below:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">hoge</span>(<span class="hljs-params"></span>) {
	<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}

<span class="hljs-keyword">const</span> _fuga = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getFullYear</span>();

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fuga</span>(<span class="hljs-params"></span>) {
	<span class="hljs-keyword">return</span> _fuga;
}
</code></pre>
<p>the bundled output will be like above:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hoge</span>(<span class="hljs-params"></span>) {
	<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getFullYear</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">hoge</span>());
</code></pre>
<p><a href="https://rollupjs.org/repl/?version=2.78.1&#x26;shareable=JTdCJTIybW9kdWxlcyUyMiUzQSU1QiU3QiUyMm5hbWUlMjIlM0ElMjJtYWluLmpzJTIyJTJDJTIyY29kZSUyMiUzQSUyMmltcG9ydCUyMCU3QiUyMGhvZ2UlMjAlN0QlMjBmcm9tJTIwJTVDJTIyLiUyRm1vZCU1QyUyMiUzQiU1Q24lNUNuY29uc29sZS5sb2coaG9nZSgpKSUyMiUyQyUyMmlzRW50cnklMjIlM0F0cnVlJTdEJTJDJTdCJTIybmFtZSUyMiUzQSUyMm1vZC5qcyUyMiUyQyUyMmNvZGUlMjIlM0ElMjJleHBvcnQlMjBmdW5jdGlvbiUyMGhvZ2UoKSUyMCU3QiU1Q24lNUN0cmV0dXJuJTIwMSUzQiU1Q24lN0QlNUNuJTVDbmNvbnN0JTIwX2Z1Z2ElMjAlM0QlMjBuZXclMjBEYXRlKCkuZ2V0RnVsbFllYXIoKSUzQiU1Q24lNUNuZXhwb3J0JTIwZnVuY3Rpb24lMjBmdWdhKCklMjAlN0IlNUNuJTVDdHJldHVybiUyMF9mdWdhJTNCJTVDbiU3RCUyMiU3RCU1RCUyQyUyMm9wdGlvbnMlMjIlM0ElN0IlMjJmb3JtYXQlMjIlM0ElMjJlcyUyMiUyQyUyMm5hbWUlMjIlM0ElMjJteUJ1bmRsZSUyMiUyQyUyMmFtZCUyMiUzQSU3QiUyMmlkJTIyJTNBJTIyJTIyJTdEJTJDJTIyZ2xvYmFscyUyMiUzQSU3QiU3RCU3RCUyQyUyMmV4YW1wbGUlMjIlM0FudWxsJTdE">https://rollupjs.org/repl/?version=2.78.1&#x26;shareable=JTdCJTIybW9kdWxlcyUyMiUzQSU1QiU3QiUyMm5hbWUlMjIlM0ElMjJtYWluLmpzJTIyJTJDJTIyY29kZSUyMiUzQSUyMmltcG9ydCUyMCU3QiUyMGhvZ2UlMjAlN0QlMjBmcm9tJTIwJTVDJTIyLiUyRm1vZCU1QyUyMiUzQiU1Q24lNUNuY29uc29sZS5sb2coaG9nZSgpKSUyMiUyQyUyMmlzRW50cnklMjIlM0F0cnVlJTdEJTJDJTdCJTIybmFtZSUyMiUzQSUyMm1vZC5qcyUyMiUyQyUyMmNvZGUlMjIlM0ElMjJleHBvcnQlMjBmdW5jdGlvbiUyMGhvZ2UoKSUyMCU3QiU1Q24lNUN0cmV0dXJuJTIwMSUzQiU1Q24lN0QlNUNuJTVDbmNvbnN0JTIwX2Z1Z2ElMjAlM0QlMjBuZXclMjBEYXRlKCkuZ2V0RnVsbFllYXIoKSUzQiU1Q24lNUNuZXhwb3J0JTIwZnVuY3Rpb24lMjBmdWdhKCklMjAlN0IlNUNuJTVDdHJldHVybiUyMF9mdWdhJTNCJTVDbiU3RCUyMiU3RCU1RCUyQyUyMm9wdGlvbnMlMjIlM0ElN0IlMjJmb3JtYXQlMjIlM0ElMjJlcyUyMiUyQyUyMm5hbWUlMjIlM0ElMjJteUJ1bmRsZSUyMiUyQyUyMmFtZCUyMiUzQSU3QiUyMmlkJTIyJTNBJTIyJTIyJTdEJTJDJTIyZ2xvYmFscyUyMiUzQSU3QiU3RCU3RCUyQyUyMmV4YW1wbGUlMjIlM0FudWxsJTdE</a></p>
<p>Why is an unnecessary <code>new Date().getFullYear()</code> in the bundled output? Because <code>new Date().getFullYear()</code> has side-effect. In JavaScript, imported module is executed once on import, so a bundler cannot remove a line which have side-effect like <code>new Date().getFullYear()</code>. If you import <code>fuga</code> module, it is expected that <code>new Date().getFullYear()</code> will be inserted in a bundled output, but if you don't import <code>fuga</code> module, it is not expected that <code>new Date().getFullYear()</code> will be inserted in a bundled output because the other module, <code>hoge</code>, does not need <code>const _fuga = new Date().getFullYear()</code> !!</p>
<h2 id="2__4">How to use?</h2>
<p>First, global install Treeche.</p>
<pre><code class="hljs language-shell">npm install treeche -g
treeche "**/*.ts" --excludes "node_modules" "**/*.test.ts"
</code></pre>
<h2 id="2__5">Options</h2>





























<table><thead><tr><th align="center">kind</th><th align="center">name</th><th align="center">description</th><th align="center">example</th></tr></thead><tbody><tr><td align="center">argument</td><td align="center">inputs</td><td align="center">input files to check tree-shakable. you can use Node glob pattern</td><td align="center">treeche "src/**/*.ts"</td></tr><tr><td align="center">option</td><td align="center">excludes</td><td align="center">excludes files to filter from inputs. you can use Node glob pattern</td><td align="center">treeche "src/**/*.ts" --e "node_modules"</td></tr><tr><td align="center">option</td><td align="center">entry point</td><td align="center">the unique entry point to check tree-shakable. if you specify input with this, treeche will bundle so you can check tree-shakable also in node_modules</td><td align="center">treeche --entry-point ./src/main.ts</td></tr></tbody></table>
<h2 id="2__6">How to work?</h2>
<p>The principle is really simple. Treeche runs rollup, which is JavaScript module bundler, internally to bundle the virtual entrypoint code which imports the input module like below.</p>
<pre><code class="hljs language-javascript">
<span class="hljs-keyword">import</span> <span class="hljs-string">"./your-module"</span>

</code></pre>
<p>If there is a side-effect in "./your-module", the output will include the code other than import.</p>
<h2 id="2__7">Feedback</h2>
<p>This is experimental project, so your feedback is welcome!!</p></div><div class="XTxSDCE1gmhoF59UaA7g"><div class="mdGYkZO2YHxhxRXU338z"><div class="O6UishUpXe8xGlTrCl8G"><img src="/assets/static/icon_transparent.png" class="J5UgGRYhWe9JWeYlm2bw" alt="monkey-icon" width="270px" height="270px"></div><div class="cab8_7jeBIe5dRHd8ikS"><div class="kEage_DVZV_Stt0z3eAT"><div class="_5U8hWpqU834VUiKxwCpA"><img src="/assets/static/earth.png" alt="earth" width="50px" height="50px"></div></div></div></div><div class="baseprofile"><div class="_pakeuUKwDGIGV1PIDFI">Hi <span role="img" aria-label="wave hand">üëã</span> I&#x27;m <span class="zQUgJkaqGKzVRFrvk7mk">Shinobu Hayashi a.k.a Shinyaigeek(„Åó„Å´„ÇÉ„ÅÑ)</span>.</div><div class="CMC6WyjhCeKfvY5zyyq0"><span data-text="Web Developer" class="v7yavk2O9dr3NZXn186P">Web Developer</span> <g-emoji fallback-src="/assets/static/spider_web.png" alias="spider-web">üï∏</g-emoji> / <span data-text="Reliable web Enthusiast" class="v7yavk2O9dr3NZXn186P">Reliable Web Enthusiast</span> <g-emoji fallback-src="/assets/static/fire.png" alias="fire">üî•</g-emoji> </div><div class="gA7tXpIz5V3YPffc9WIr">Faster, Lighter, More accessible, More secure, More productive Web for anyone, anytime , anywhere.</div><div class="v0ZqRqZjlqevKrsWtDTt"><div class="zdvavtYkqc1dXYPR1y0c"><a id="twitter" href="https://twitter.com/Shinyaigeek"><img src="/assets/static/twitter.svg" alt="twitter" width="54px" height="54px"></a></div><div class="zdvavtYkqc1dXYPR1y0c"><a id="github" href="https://github.com/Shinyaigeek"><img src="/assets/static/github.svg" alt="github" width="54px" height="54px"></a></div><div class="zdvavtYkqc1dXYPR1y0c"><a id="linkedin" href="https://www.linkedin.com/in/shinyaigeek/"><img src="/assets/static/linkedin.svg" alt="linkedin" width="54px" height="54px"></a></div></div><div class="l5KzSvykijElHJc7q2c9"><a href="mailto:me@shinyaigeek.dev">Contact Me on Email <g-emoji fallback-src="/assets/static/email.png" alias="email">üìß</g-emoji></a></div></div></div></div></div><div class="AJQSVdi_FHylcHDbYLWV">Copyright. 2022 Shinyaigeek</div></div></div></body><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;0893ac88cf0542af88bfd9b93008b408&quot;, &quot;spa&quot;: true}"></script><script defer="" src="/assets/r.a0d01c88f547277aab5a.js" async=""></script></html>