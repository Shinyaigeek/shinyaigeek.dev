<!DOCTYPE html><html lang="ja"><head><title>pnpm outdated コマンドが JSON format をサポートした | shinyaigeek.dev</title><meta charset="utf8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><meta property="og:title" content="pnpm outdated コマンドが JSON format をサポートした | shinyaigeek.dev"><meta property="og:site_name" content="shinyaigeek.dev"><meta property="og:locale" content="ja_JP"><meta name="description" content="Web が好きなオタクのブログ. 主にweb開発の知見について喋ります"><meta property="og:description" content="Web が好きなオタクのブログ. 主にweb開発の知見について喋ります"><meta property="og:url" content="https://shinyaigeek.dev/ja/post/pnpm-outdated-command-supports-json-format"><meta name="twitter:site" content="@shinyaigeek"><meta property="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta property="og:image" content="https://ja.shinyaigeek.dev/assets/ogimage/ja/pnpm-outdated-command-supports-json-format.png"><meta name="twitter:image" content="https://ja.shinyaigeek.dev/assets/ogimage/ja/pnpm-outdated-command-supports-json-format.png"><link rel="icon" type="image/x-icon" href="/assets/static/favicon.ico"><link rel="stylesheet" type="text/css" href="/assets/styles.ada9902fc362b01889c3.css"><link rel="stylesheet" type="text/css" href="/assets/static/a11y-dark.min.css"><link rel="stylesheet" href="https://unpkg.com/github-calendar@latest/dist/github-calendar-responsive.css"><link rel="preload" as="style" href="/assets/static/a11y-dark.min.css"><link rel="preload" as="style" href="/assets/styles.ada9902fc362b01889c3.css"><link rel="preload" as="style" href="https://unpkg.com/github-calendar@latest/dist/github-calendar-responsive.css"><link rel="preload" as="image" href="/assets/static/icon_transparent_header.png"><link rel="alternate" type="application/rss+xml" title="shinyaigeek.dev" href="/rss.xml"></head><body><div id="_app"><div class="fmapAu0fpx364Dzl_9z0"><div class="J2e3WZniL57BvLtita5T"><div class="kVHiWHyN1gv5Y41SpACy"><a href="/" class="link2Home"><div><img src="/assets/static/icon_transparent_header.png" alt="icon" class="vwQ8HQPKPoICc2atrDju" width="36px" height="36px">shinyaigeek.dev</div></a></div><div class="hOkVSJvM823tjX0FjgO_"><div class="FpNMxf5Gx0pwkDBdeqif"><details><summary> <span role="img" aria-label="language"><g-emoji fallback-src="/assets/static/earth_africa.png" alias="earth">🌍</g-emoji></span> 日本語</summary><div class="ZAVxrSvsXSeI9pV9Rbax"><a href="http://ja.shinyaigeek.dev/post/pnpm-outdated-command-supports-json-format" class="aYFqAG93sRJ7BJMCPjsa undefined"><span role="img" aria-label="country"><g-emoji fallback-src="/assets/static/jp.png" alias="Japan">🇯🇵</g-emoji></span>日本語</a><a href="https://en.shinyaigeek.dev/post/pnpm-outdated-command-supports-json-format" class="aYFqAG93sRJ7BJMCPjsa"><span role="img" aria-label="country"><span><g-emoji fallback-src="/assets/static/us.png" alias="America">🇺🇸</g-emoji><g-emoji fallback-src="/assets/static/gb.png" alias="United States">🇬🇧</g-emoji></span></span>English</a></div></details></div><div class="FpNMxf5Gx0pwkDBdeqif"><a href="/" class="link2Home">Blog</a></div><div class="FpNMxf5Gx0pwkDBdeqif"><a href="/profile" id="link2profile">Profile</a></div><div class="FpNMxf5Gx0pwkDBdeqif"><a href="https://github-activity.shinyaigeek.dev/" id="link2activity">Activity</a></div></div></div><div class="sxaQUUuymSmhNwqAMaks"><div><details class="h0AHqg9AmVXjXCnYqFqc"><summary class="post--anchor__title" id="post--anchor__title">目次</summary><a href="#2__0">TL;DR</a><a href="#2__1">pnpm とは</a><a href="#2__2">pnpm outdated コマンドについて</a><a href="#2__3">pnpm outdated コマンドに JSON 形式の出力をサポートしたかったモチベーション</a><a href="#2__4">format オプションについて</a><a href="#2__5">JSON 形式の出力例</a></details><div class="Y8c8TlU3k_Y72ndSGmnk"><h1>pnpm outdated コマンドが JSON format をサポートした</h1><div>2022/11/06</div><div class="BYkaTwWlH4C2pP1hi2JY"><div>Blog</div><div>JavaScript</div><div>TypeScript</div><div>OSS</div></div></div><div class="L6tHhpo3uw534DnsakEH"><h2 id="2__0">TL;DR</h2>
<ul>
<li>pnpm outdated コマンドが JSON 形式の出力をサポートした</li>
<li>これでプロジェクト中の依存パッケージの自動アップデートなどがやりやすくなる</li>
<li>実装を担当していたので, 実装や変化, ユースケースをブログに示す</li>
</ul>
<h2 id="2__1">pnpm とは</h2>
<p><a href="https://pnpm.io/">https://pnpm.io/</a></p>
<p>pnpm とは Node.js 環境におけるパッケージマネージャーの一つです. パッケージマネージャーとして, 他のツールだと npm や yarn が挙げられます.</p>
<p>pnpm は symlink を用いて, npm モジュールの高速で省容量なダウンロードを提供しています. 通常あるプロジェクトで npm モジュールをインストールすると, <code>node_modules</code> 以下にそれらのモジュール, とさらにネストされた依存モジュール群が全て展開されます. pnpm はプロジェクトを跨いで, それらのモジュールを単一のディスク領域へと保存し, プロジェクト配下にはそれへのハードリンクが展開されるようになります. また, 異なるバージョンのモジュールに依存している際, それら一つ一つを丸々 install するのではなく, それらのモジュールごとの更新の差分のみを保存します. これらの方法により省容量で高速なモジュールのインストールを実現しています.</p>
<p>また, pnpm の特徴として大胆に他のパッケージマネージャーにはない utility コマンドやオプションを追加して行っている, といったことも挙げられます.</p>
<p><a href="https://twitter.com/Shinyaigeek/status/1577947254916550656"><img src="../../../assets/pnpm-outdated-command-supports-json-format/tweet.png" alt="tweet i have joined pnpm"></a></p>
<p>pnpm のメンバーとして, <code>pnpm outdated</code> コマンドに JSON 形式での出力機能を実装したので, それについてブログに書き起こそうと思います.</p>
<h2 id="2__2">pnpm outdated コマンドについて</h2>
<p><code>pnpm outdated</code> コマンドは, プロジェクト中の依存モジュールのうち, deprecate されていたり新しいバージョンが publish されているなどで, 古くなったモジュールを洗い出すためのコマンドです.</p>
<p>例えばこのブログで <code>pnpm outdated</code> を実行すると以下のような出力が得られます.</p>
<p><img src="../../../assets/pnpm-outdated-command-supports-json-format/pnpm-outdated.png" alt="pnpm outdated を実行した結果"></p>
<p>また list 形式での出力もサポートしており, <code>pnpm outdated --table false</code> と実行すると以下のような出力が得られます.</p>
<p><img src="../../../assets/pnpm-outdated-command-supports-json-format/pnpm-outdated-with-list.png" alt="pnpm outdated --table false を実行した結果"></p>
<h2 id="2__3">pnpm outdated コマンドに JSON 形式の出力をサポートしたかったモチベーション</h2>
<p>モチベーションとしては, 上記のような table 形式, list 形式での出力だとパッケージのアップデートを自動化したい, となったときにそれら形式はヒューマンフレンドリーに偏っており, 逆に自動化しにくい, といった背景がありました.
自動化しやすいように, 出力フォーマットとして JSON 形式をサポートすることになりました.</p>
<h2 id="2__4">format オプションについて</h2>
<p>JSON 形式の出力のサポートのために, <code>--format</code> が追加されました. 一方これは <code>--table {boolean}</code> と責務が微妙に被ってしまいます. また <code>--table</code> は boolean 値を取るため, 命名的にも機能的にも <code>--table</code> で JSON 形式での出力を指定できるようにすべきではありません. また責務も被るため, その解消として <code>--format {table | list | json}</code> と取れるようにし, <code>--table</code> は削除されました. (<a href="https://github.com/pnpm/pnpm/blob/main/packages/plugin-commands-outdated/src/outdated.ts#L43">実装</a></p>
<h2 id="2__5">JSON 形式の出力例</h2>
<p><code>pnpm outdated --format json</code> を実行します.</p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"uglify-es"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"current"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3.3.9"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"latest"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3.3.9"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"wanted"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3.3.9"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"isDeprecated"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dependencyType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dependencies"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"highlight.js"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"current"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"11.3.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"latest"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"11.6.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"wanted"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"11.3.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"isDeprecated"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dependencyType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dependencies"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"@types/highlight.js"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"current"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9.12.4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"latest"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"10.1.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"wanted"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9.12.4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"isDeprecated"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dependencyType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"devDependencies"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  ...
</code></pre>
<p>自動化しやすそうでハッピーですね. 2022/11/06 時点ではまだリリースされていませんが, 次の minor release で出ると思うので待ち遠しいです.</p></div><div class="XTxSDCE1gmhoF59UaA7g"><div class="mdGYkZO2YHxhxRXU338z"><div class="O6UishUpXe8xGlTrCl8G"><img src="/assets/static/icon_transparent.png" class="J5UgGRYhWe9JWeYlm2bw" alt="monkey-icon" width="270px" height="270px"></div><div class="cab8_7jeBIe5dRHd8ikS"><div class="kEage_DVZV_Stt0z3eAT"><div class="_5U8hWpqU834VUiKxwCpA"><img src="/assets/static/earth.png" alt="earth" width="50px" height="50px"></div></div></div></div><div class="baseprofile"><div class="_pakeuUKwDGIGV1PIDFI">Hi <span role="img" aria-label="wave hand">👋</span> I&#x27;m <span class="zQUgJkaqGKzVRFrvk7mk">Shinobu Hayashi a.k.a Shinyaigeek(しにゃい)</span>.</div><div class="CMC6WyjhCeKfvY5zyyq0"><span data-text="Web Developer" class="v7yavk2O9dr3NZXn186P">Web Developer</span> <g-emoji fallback-src="/assets/static/spider_web.png" alias="spider-web">🕸</g-emoji> / <span data-text="Reliable web Enthusiast" class="v7yavk2O9dr3NZXn186P">Reliable Web Enthusiast</span> <g-emoji fallback-src="/assets/static/fire.png" alias="fire">🔥</g-emoji> </div><div class="gA7tXpIz5V3YPffc9WIr">Faster, Lighter, More accessible, More secure, More productive Web for anyone, anytime , anywhere.</div><div class="v0ZqRqZjlqevKrsWtDTt"><div class="zdvavtYkqc1dXYPR1y0c"><a id="twitter" href="https://twitter.com/Shinyaigeek"><img src="/assets/static/twitter.svg" alt="twitter" width="54px" height="54px"></a></div><div class="zdvavtYkqc1dXYPR1y0c"><a id="github" href="https://github.com/Shinyaigeek"><img src="/assets/static/github.svg" alt="github" width="54px" height="54px"></a></div><div class="zdvavtYkqc1dXYPR1y0c"><a id="linkedin" href="https://www.linkedin.com/in/shinyaigeek/"><img src="/assets/static/linkedin.svg" alt="linkedin" width="54px" height="54px"></a></div></div><div class="l5KzSvykijElHJc7q2c9"><a href="mailto:me@shinyaigeek.dev">Contact Me on Email <g-emoji fallback-src="/assets/static/email.png" alias="email">📧</g-emoji></a></div></div></div></div></div><div class="AJQSVdi_FHylcHDbYLWV">Copyright. 2022 Shinyaigeek</div></div></div></body><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;0893ac88cf0542af88bfd9b93008b408&quot;, &quot;spa&quot;: true}"></script><script defer="" src="/assets/r.a0d01c88f547277aab5a.js" async=""></script></html>